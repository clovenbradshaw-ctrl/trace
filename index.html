<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TRACE Badge Generator</title>
  <link rel="icon" href="favicon.png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNa5kLrBP1ZiZsa1+lZeI7IuAvV38DSHLVYDBlnJrped1IovnEwlHGawEq+y3OC/YLXTr4a9L5xRngRlwe5VrA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <style>
    :root {
      --bg: #fff;
      --fg: #333;
      --accent: #007bff;
      --badge: 120px;
    }

    body {
      margin: 0;
      font-family: sans-serif;
      background: var(--bg);
      color: var(--fg);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      padding: 1rem;
      border-bottom: 1px solid #ccc;
    }

    .header-title {
      margin: 0;
    }

    .main-container {
      flex: 1;
      display: grid;
      grid-template-areas:
        "controls badge citation"
        "models models models";
      grid-template-columns: 1fr 1fr 1fr;
      gap: 1rem;
      padding: 1rem;
    }

    .left-panel { grid-area: controls; }
    .badge-panel { grid-area: badge; display: flex; align-items: center; justify-content: center; }
    .citation-panel { grid-area: citation; }
    .models-panel { grid-area: models; }

    .badge {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(2, 1fr);
      width: var(--badge);
      height: var(--badge);
      border: 2px solid #000;
    }

    .badge .cell {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      border: 1px solid #000;
    }

    .badge .code { font-weight: bold; }
    .badge .label { font-size: 0.7em; }

    .quadrant { border: 2px solid var(--accent); padding: 0.5rem; margin-bottom: 0.5rem; }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: #fff;
      padding: 1rem;
      max-width: 500px;
      width: 90%;
    }

    .wizard-buttons { text-align: right; margin-top: 1rem; }

    .model-list { display: flex; flex-wrap: wrap; gap: 0.5rem; }
    .model-item { border: 1px solid #ccc; padding: 0.25rem 0.5rem; cursor: pointer; }
    .model-item.selected { background: var(--accent); color: #fff; }

    @media (max-width: 768px) {
      .main-container {
        grid-template-areas:
          "badge"
          "controls"
          "citation"
          "models";
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <h1 class="header-title">TRACE Badge Generator</h1>
  </header>

  <div class="main-container">
    <section class="left-panel">
      <fieldset class="quadrant" id="role-group">
        <legend>Role</legend>
        <label><input type="radio" name="role" value="A"> Assist</label><br>
        <label><input type="radio" name="role" value="D"> Draft</label>
      </fieldset>
      <fieldset class="quadrant" id="data-group">
        <legend>Data</legend>
        <label><input type="radio" name="data" value="P"> Proprietary</label><br>
        <label><input type="radio" name="data" value="O"> Open</label>
      </fieldset>
      <fieldset class="quadrant" id="method-group">
        <legend>Method</legend>
        <label><input type="radio" name="method" value="T"> Transform</label><br>
        <label><input type="radio" name="method" value="G"> Generate</label>
      </fieldset>
      <fieldset class="quadrant" id="review-group">
        <legend>Review</legend>
        <label><input type="radio" name="review" value="H"> Human</label><br>
        <label><input type="radio" name="review" value="N"> None</label>
      </fieldset>
      <button id="download-btn">Download</button>
    </section>

    <section class="badge-panel">
      <div id="badge" class="badge">
        <div id="cell-role" class="cell"><span class="code"></span><span class="label"></span></div>
        <div id="cell-data" class="cell"><span class="code"></span><span class="label"></span></div>
        <div id="cell-method" class="cell"><span class="code"></span><span class="label"></span></div>
        <div id="cell-review" class="cell"><span class="code"></span><span class="label"></span></div>
      </div>
    </section>

    <section class="citation-panel">
      <h3>Citation</h3>
      <pre id="citation-output"></pre>
    </section>

    <section class="models-panel">
      <h3>AI Models</h3>
      <div class="model-list" id="model-list"></div>
      <div class="selected-models" id="selected-models"></div>
    </section>
  </div>

  <div class="modal" id="wizard">
    <div class="modal-content">
      <h3>Wizard</h3>
      <p id="wizard-text"></p>
      <div class="wizard-buttons">
        <button onclick="closeWizard()">Close</button>
      </div>
    </div>
  </div>

  <script>
    const TAGS = {
      role: { A: 'Assist', D: 'Draft', S: 'Synthesis', R: 'Review' },
      data: { P: 'Proprietary', O: 'Open' },
      method: { T: 'Transform', G: 'Generate' },
      review: { H: 'Human', N: 'None' }
    };

    class ModelMemory {
      constructor() { this.models = []; }
      add(m) { if (!this.models.includes(m)) this.models.push(m); }
      remove(m) { this.models = this.models.filter(x => x !== m); }
    }

    class ModelSearch {
      constructor(memory) { this.memory = memory; }
      load(list) { this.list = list; }
    }

    const memory = new ModelMemory();

    function updateBadge() {
      ['role', 'data', 'method', 'review'].forEach(type => {
        const val = document.querySelector(`input[name="${type}"]:checked`);
        const cell = document.getElementById('cell-' + type);
        if (val) {
          cell.querySelector('.code').textContent = val.value;
          cell.querySelector('.label').textContent = TAGS[type][val.value];
        } else {
          cell.querySelector('.code').textContent = '';
          cell.querySelector('.label').textContent = '';
        }
      });
      updateOutputs();
    }

    function updateOutputs() {
      const r = document.querySelector('input[name="role"]:checked');
      const d = document.querySelector('input[name="data"]:checked');
      const m = document.querySelector('input[name="method"]:checked');
      const v = document.querySelector('input[name="review"]:checked');
      if (r && d && m && v) {
        document.getElementById('citation-output').textContent =
          `Role: ${TAGS.role[r.value]}, Data: ${TAGS.data[d.value]}, Method: ${TAGS.method[m.value]}, Review: ${TAGS.review[v.value]}`;
      } else {
        document.getElementById('citation-output').textContent = '';
      }
    }

    function loadAIModels() {
      const models = ['gpt-4', 'gpt-3.5', 'llama-2'];
      const list = document.getElementById('model-list');
      models.forEach(model => {
        const item = document.createElement('div');
        item.className = 'model-item';
        item.textContent = model;
        item.onclick = () => {
          item.classList.toggle('selected');
          if (item.classList.contains('selected')) memory.add(model);
          else memory.remove(model);
          renderSelectedModels();
        };
        list.appendChild(item);
      });
    }

    function renderSelectedModels() {
      const box = document.getElementById('selected-models');
      box.textContent = memory.models.join(', ');
    }

    function openWizard(section) {
      document.getElementById('wizard-text').textContent = 'Help for ' + section;
      document.getElementById('wizard').style.display = 'flex';
    }

    function closeWizard() {
      document.getElementById('wizard').style.display = 'none';
    }

    async function downloadBadge() {
      const downloadBtn = document.getElementById('download-btn');
      const originalText = downloadBtn.textContent;
      try {
        downloadBtn.disabled = true;
        downloadBtn.textContent = 'Generating...';
        const badge = document.getElementById('badge');
        const canvas = await html2canvas(badge, { scale: 3, backgroundColor: null });
        canvas.toBlob(blob => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'trace-badge.png';
          a.click();
          URL.revokeObjectURL(url);
          downloadBtn.textContent = 'Downloaded!';
          setTimeout(() => { downloadBtn.textContent = originalText; downloadBtn.disabled = false; }, 2000);
        });
      } catch (err) {
        console.error('Download failed', err);
        downloadBtn.textContent = 'Error';
        setTimeout(() => { downloadBtn.textContent = originalText; downloadBtn.disabled = false; }, 2000);
      }
    }

    function paint() { updateBadge(); }

    document.getElementById('download-btn').addEventListener('click', downloadBadge);
    document.querySelectorAll('input').forEach(el => el.addEventListener('change', updateBadge));
    loadAIModels();
    paint();
  </script>
</body>
</html>

