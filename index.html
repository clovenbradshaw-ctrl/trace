<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TRACE Badge Generator</title>
<link rel="icon" type="image/png" href="https://storage.googleapis.com/art_homelessness/android-chrome-192x192.png" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
  :root {
    --badge: 360px;
    --edge: 10px;
  }

  body {
    font-family: system-ui, sans-serif;
    margin: 1rem;
    line-height: 1.4;
    background: #f8fafc;
  }

  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
  }

  h2 { 
    font-size: 1.8rem; 
    margin: 0; 
    color: #1e293b; 
  }

  .main-content {
    display: flex;
    gap: 2rem;
    align-items: flex-start;
    margin-bottom: 2rem;
  }

  /* ---------- Badge and Citation Wrapper ---------- */
  .badge-and-citation {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    order: 2;
  }

  /* ---------- Badge ---------- */
  .badge-section {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  /* ---------- Controls ---------- */
  .controls-section {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    min-width: 400px;
    max-width: 500px;
    overflow: hidden;
    word-wrap: break-word;
    order: 1;
  }

  .badge {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr 1fr;
    width: var(--badge);
    height: var(--badge);
    border-radius: calc(var(--badge) * 0.12);
    position: relative;
    overflow: hidden;
    box-shadow: 0 0 0 var(--edge) #cbd5e0 inset, 0 4px 12px rgba(0,0,0,0.1);
    background: #cbd5e0;
  }

  .cell {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: calc(var(--edge) * 1.8) calc(var(--edge) * 1.4);
    box-sizing: border-box;
    overflow: hidden;
  }

  /* Remove individual cell borders and use gap approach */
  .cell:nth-child(1) { 
    border-top-left-radius: calc(var(--badge) * 0.12 - var(--edge));
    margin-right: calc(var(--edge) / 2);
    margin-bottom: calc(var(--edge) / 2);
  }
  .cell:nth-child(2) { 
    border-top-right-radius: calc(var(--badge) * 0.12 - var(--edge));
    margin-left: calc(var(--edge) / 2);
    margin-bottom: calc(var(--edge) / 2);
  }
  .cell:nth-child(3) { 
    border-bottom-left-radius: calc(var(--badge) * 0.12 - var(--edge));
    margin-right: calc(var(--edge) / 2);
    margin-top: calc(var(--edge) / 2);
  }
  .cell:nth-child(4) { 
    border-bottom-right-radius: calc(var(--badge) * 0.12 - var(--edge));
    margin-left: calc(var(--edge) / 2);
    margin-top: calc(var(--edge) / 2);
  }

  .code  { 
    font-weight: 600; 
    line-height: 1.1;
    white-space: normal;
    max-width: 100%;
    margin-bottom: calc(var(--edge) * 0.8);
    color: white;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    text-align: center;
  }

  .label {
    line-height: 1.0;
    white-space: normal;
    word-break: break-word;
    line-break: anywhere;
    hyphens: auto;
    overflow-wrap: break-word;
    max-width: 100%;
    color: white;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
  }

  #cell-role { background: #06b6d4; }
  #cell-data { background: #22c55e; }
  #cell-method { background: #f97316; }
  #cell-review { background: #8b5cf6; }

  /* Grayscale mode */
  .badge.grayscale #cell-role { background: #374151; }
  .badge.grayscale #cell-data { background: #6b7280; }
  .badge.grayscale #cell-method { background: #9ca3af; }
  .badge.grayscale #cell-review { background: #d1d5db; }

  .badge.grayscale {
    box-shadow: 0 0 0 var(--edge) #9ca3af inset, 0 4px 12px rgba(0,0,0,0.1);
    background: #9ca3af;
  }

  .badge-actions {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .badge-models {
    background: #f8fafc;
    border-radius: 8px;
    padding: 0.75rem;
    border: 1px solid #e2e8f0;
  }

  .badge-models-title {
    font-weight: 600;
    color: #374151;
    font-size: 0.85rem;
    margin-bottom: 0.5rem;
  }

  .badge-models-list {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .badge-model-item {
    font-size: 0.8rem;
    color: #6b7280;
    line-height: 1.3;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .badge-model-provider {
    font-weight: 500;
    color: #374151;
  }

  /* ---------- Controls ---------- */
  .controls-section {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    min-width: 400px;
    max-width: 500px;
    overflow: hidden;
    word-wrap: break-word;
  }

  .ai-model-section {
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #e2e8f0;
  }

  .ai-model-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .ai-model-title {
    font-weight: 600;
    color: #1e293b;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .refresh-btn {
    background: #f1f5f9;
    border: 1px solid #e2e8f0;
    border-radius: 4px;
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
    cursor: pointer;
    color: #64748b;
    transition: all 0.2s;
  }

  .refresh-btn:hover {
    background: #e2e8f0;
    color: #475569;
  }

  .model-selector {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    max-width: 100%;
    overflow: hidden;
  }

  .model-dropdowns {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.75rem;
    max-width: 100%;
  }

  .dropdown-group {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .dropdown-group label {
    font-size: 0.8rem;
    font-weight: 500;
    color: #374151;
    margin: 0;
  }

  .make-select,
  .model-select {
    padding: 0.5rem;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 0.9rem;
    background: white;
    width: 100%;
    max-width: 100%;
  }

  .model-select:disabled {
    background: #f9fafb;
    color: #9ca3af;
    cursor: not-allowed;
  }

  .model-select option,
  .make-select option {
    white-space: normal;
    word-wrap: break-word;
    padding: 0.25rem 0.5rem;
    line-height: 1.4;
  }

  .selected-models {
    margin-top: 1rem;
    padding: 1rem;
    background: #f8fafc;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
  }

  .selected-models-header {
    font-weight: 500;
    color: #374151;
    margin-bottom: 0.75rem;
    font-size: 0.9rem;
  }

  .selected-models-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .selected-model-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem;
    background: white;
    border-radius: 6px;
    border: 1px solid #e5e7eb;
    max-width: 100%;
    overflow: hidden;
  }

  .model-item-info {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
    flex: 1;
    min-width: 0;
    margin-right: 0.5rem;
  }

  .model-item-name {
    font-weight: 500;
    color: #111827;
    font-size: 0.85rem;
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
    line-height: 1.2;
  }

  .model-item-provider {
    color: #6b7280;
    font-size: 0.75rem;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .remove-model-btn {
    background: #fee2e2;
    color: #dc2626;
    border: 1px solid #fecaca;
    border-radius: 4px;
    padding: 0.25rem;
    cursor: pointer;
    font-size: 0.75rem;
    transition: all 0.2s;
  }

  .remove-model-btn:hover {
    background: #fecaca;
  }

  /* Modal Styles */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 1rem;
  }

  .modal-content {
    background: white;
    border-radius: 12px;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    max-width: 500px;
    width: 100%;
    max-height: 80vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid #e5e7eb;
  }

  .modal-header h3 {
    margin: 0;
    font-size: 1.25rem;
    color: #111827;
  }

  .modal-close {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 4px;
    color: #6b7280;
    transition: all 0.2s;
  }

  .modal-close:hover {
    background: #f3f4f6;
    color: #374151;
  }

  .modal-body {
    padding: 1.5rem;
    flex: 1;
    overflow-y: auto;
  }

  .modal-footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid #e5e7eb;
    display: flex;
    justify-content: flex-end;
    gap: 0.75rem;
  }

  .wizard-intro p {
    color: #6b7280;
    margin: 0;
    line-height: 1.6;
  }

  .wizard-question {
    text-align: center;
  }

  .question-progress {
    background: #f3f4f6;
    border-radius: 20px;
    padding: 0.5rem 1rem;
    font-size: 0.85rem;
    color: #6b7280;
    margin-bottom: 1.5rem;
    display: inline-block;
  }

  .question-tag {
    background: #eff6ff;
    border: 1px solid #dbeafe;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1.5rem;
    color: #1e40af;
  }

  .question-text {
    font-size: 1.1rem;
    color: #374151;
    margin-bottom: 2rem;
    line-height: 1.6;
    font-style: italic;
  }

  .question-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
  }

  .wizard-complete {
    text-align: center;
  }

  .complete-icon {
    width: 60px;
    height: 60px;
    background: #10b981;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    margin: 0 auto 1rem;
  }

  .wizard-complete h4 {
    color: #10b981;
    margin: 0 0 0.5rem;
    font-size: 1.25rem;
  }

  .wizard-complete p {
    color: #6b7280;
    margin: 0 0 1.5rem;
  }

  .selected-tags {
    background: #f8fafc;
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid #e2e8f0;
  }

  .selected-tag {
    display: inline-block;
    background: #3b82f6;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.85rem;
    margin: 0.25rem;
    font-weight: 500;
  }

  .loading {
    color: #6b7280;
    font-style: italic;
  }

  .toggle-section {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #e2e8f0;
  }

  .toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    color: #64748b;
  }

  .controls { 
    display: grid; 
    grid-template-columns: 1fr 1fr;
    gap: 1rem; 
  }

  fieldset { 
    border: 1px solid #e2e8f0; 
    padding: 1rem; 
    border-radius: 8px; 
    background: #f8fafc;
    margin: 0;
  }

  legend { 
    padding: 0 0.5rem; 
    font-weight: 600; 
    color: #1e293b;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .help-btn {
    background: #f1f5f9;
    border: 1px solid #e2e8f0;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #64748b;
    transition: all 0.2s;
    padding: 0;
  }

  .help-btn:hover {
    background: #e2e8f0;
    color: #475569;
    transform: scale(1.1);
  }

  label:not(.option-card) {
    display: flex;
    align-items: center;
    margin: 0.5rem 0;
    font-size: 0.9rem;
    color: #475569;
    cursor: pointer;
  }

  label:not(.option-card) input {
    margin-right: 0.5rem;
  }

  .option-cards {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .option-card {
    display: block;
    cursor: pointer;
    transition: all 0.2s;
  }

  .option-card input {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }

  .card-content {
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    padding: 0.75rem;
    background: white;
    transition: all 0.2s;
  }

  .option-card input:checked + .card-content {
    border-color: #3b82f6;
    background: #eff6ff;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }

  .option-card input:disabled + .card-content {
    opacity: 0.5;
    cursor: not-allowed;
    background: #f9fafb;
  }

  .card-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.25rem;
  }

  .card-content .code {
    background: #1e293b;
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-weight: 600;
    font-size: 0.9rem;
  }

  .card-content .label {
    font-weight: 500;
    color: #1e293b;
  }

  .help-text {
    font-size: 0.8rem;
    color: #64748b;
    margin-top: 0.25rem;
    font-style: italic;
  }

  /* Citation Section */
  .citation-section {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin: 0;
  }

  .citation-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .citation-title {
    font-weight: 600;
    color: #1e293b;
    font-size: 1rem;
  }

  .citation-content {
    background: #f1f5f9;
    border-radius: 8px;
    padding: 1rem;
    font-family: ui-monospace, SFMono-Regular, 'Cascade Code', monospace;
    font-size: 0.85rem;
    line-height: 1.5;
    color: #334155;
    border: 1px solid #e2e8f0;
    white-space: pre-line;
  }

  .button {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: #3b82f6;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
    text-decoration: none;
  }

  .button:hover {
    background: #2563eb;
  }

  .button.secondary {
    background: #64748b;
  }

  .button.secondary:hover {
    background: #475569;
  }

  .button:disabled {
    background: #9ca3af;
    cursor: not-allowed;
  }

  .hidden-tags .label {
    display: none;
  }

  .model-info {
    font-size: 0.75rem;
    color: #6b7280;
    margin-top: 0.25rem;
    line-height: 1.3;
  }

  .status-message {
    padding: 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    margin-top: 0.5rem;
  }

  .status-success {
    background: #dcfce7;
    color: #166534;
    border: 1px solid #bbf7d0;
  }

  .status-error {
    background: #fee2e2;
    color: #dc2626;
    border: 1px solid #fecaca;
  }

  @media (max-width: 768px) {
    .main-content {
      flex-direction: column;
    }
    
    .controls { 
      grid-template-columns: 1fr;
    }
    
    .model-dropdowns {
      grid-template-columns: 1fr;
    }
    
    .controls-section {
      min-width: unset;
      max-width: unset;
      order: 2;
    }
    
    .badge-and-citation {
      order: 1;
    }

    .modal-content {
      margin: 0.5rem;
      max-width: calc(100vw - 1rem);
    }

    .question-actions {
      flex-direction: column;
    }

    .modal-footer {
      flex-direction: column-reverse;
    }

    .modal-footer .button {
      width: 100%;
      justify-content: center;
    }
  }
</style>
</head>
<body>
  <div class="header">
    <h2>TRACE Badge Generator</h2>
  </div>

  <div class="main-content">
    <div class="controls-section">
      <div class="ai-model-section">
        <div class="ai-model-header">
          <div class="ai-model-title">AI Models Used</div>
          <button class="refresh-btn" onclick="loadAIModels()" title="Refresh model list">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23,4 23,10 17,10"></polyline>
              <polyline points="1,20 1,14 7,14"></polyline>
              <path d="M20.49,9A9,9 0 0 0 5.64,5.64L1,10m22,4L18.36,18.36A9,9 0 0 1 3.51,15"></path>
            </svg>
            Refresh
          </button>
        </div>
        
        <div class="model-selector">
          <div class="model-dropdowns">
            <div class="dropdown-group">
              <label for="make-select">Make:</label>
              <select class="make-select" id="make-select">
                <option value="">Select provider...</option>
              </select>
            </div>
            <div class="dropdown-group">
              <label for="model-select">Model:</label>
              <select class="model-select" id="model-select" disabled>
                <option value="">Select model...</option>
              </select>
            </div>
          </div>
          
          <button class="button" id="add-model-btn" onclick="addSelectedModel()" disabled>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Add Model
          </button>
        </div>

        <div class="selected-models" id="selected-models-container" style="display: none;">
          <div class="selected-models-header">
            <span>Selected Models:</span>
          </div>
          <div class="selected-models-list" id="selected-models-list"></div>
        </div>
        
        <div id="model-status"></div>
      </div>

      <div class="toggle-section">
        <div class="toggle">
          <input type="checkbox" id="show-tags" checked>
          <label for="show-tags">Show tags on badge</label>
        </div>
        <div class="toggle">
          <input type="checkbox" id="grayscale-mode">
          <label for="grayscale-mode">Grayscale version</label>
        </div>
      </div>

      <div class="controls">
        <fieldset id="role-group">
          <legend>
            Role
            <button class="help-btn" onclick="openWizard('role')" title="Get help selecting role">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M9,9a3,3 0 1,1 6,0c0,2-3,3-3,3"/>
                <point cx="12" cy="17" stroke-width="3"/>
              </svg>
            </button>
          </legend>
        </fieldset>
        <fieldset id="data-group">
          <legend>
            Data
            <button class="help-btn" onclick="openWizard('data')" title="Get help selecting data">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M9,9a3,3 0 1,1 6,0c0,2-3,3-3,3"/>
                <point cx="12" cy="17" stroke-width="3"/>
              </svg>
            </button>
          </legend>
        </fieldset>
        <fieldset id="method-group">
          <legend>
            Method
            <button class="help-btn" onclick="openWizard('method')" title="Get help selecting method">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M9,9a3,3 0 1,1 6,0c0,2-3,3-3,3"/>
                <point cx="12" cy="17" stroke-width="3"/>
              </svg>
            </button>
          </legend>
        </fieldset>
        <fieldset id="review-group">
          <legend>
            Review
            <button class="help-btn" onclick="openWizard('review')" title="Get help selecting review">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M9,9a3,3 0 1,1 6,0c0,2-3,3-3,3"/>
                <point cx="12" cy="17" stroke-width="3"/>
              </svg>
            </button>
          </legend>
        </fieldset>
      </div>
    </div>

    <div class="badge-and-citation">
      <div class="badge-section">
        <div id="badge" class="badge">
          <div id="cell-role"   class="cell"><span class="code"></span><span class="label"></span></div>
          <div id="cell-data"   class="cell"><span class="code"></span><span class="label"></span></div>
          <div id="cell-method" class="cell"><span class="code"></span><span class="label"></span></div>
          <div id="cell-review" class="cell"><span class="code"></span><span class="label"></span></div>
        </div>
        
        <div class="badge-models" id="badge-models" style="display: none;">
          <div class="badge-models-title">Models Used:</div>
          <div class="badge-models-list" id="badge-models-list"></div>
        </div>
        
        <div class="badge-actions">
          <button class="button" onclick="downloadBadge()" id="download-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7,10 12,15 17,10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            Download PNG
          </button>
        </div>
      </div>

      <div class="citation-section">
        <div class="citation-header">
          <div class="citation-title">AI Attribution Citation</div>
          <button class="button secondary" onclick="copyCitation()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
            </svg>
            Copy
          </button>
        </div>
        <div id="citation-content" class="citation-content"></div>
      </div>
    </div>
  </div>

  <!-- TRACE Wizard Modal -->
  <div id="wizard-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="wizard-title">TRACE Helper</h3>
        <button class="modal-close" onclick="closeWizard()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <div class="wizard-question" id="wizard-question"></div>
      </div>

      <div class="modal-footer">
        <button class="button secondary" onclick="closeWizard()">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    const TAGS = {
      role: [
        {code:'A', label:'Assist', question:'Did I use AI mainly to clean up or polish existing text?'},
        {code:'D', label:'Draft', question:'Did AI generate the main body of text rather than me?'},
        {code:'S', label:'Synth', question:'Did I give it several inputs and ask it to merge them?'},
        {code:'N', label:'Analyze', question:'Did I ask the AI to reason, analyze, or crunch data?'},
        {code:'E', label:'Explore', question:'Was I mainly testing outputs to see what happened?'},
        {code:'C', label:'Create', question:'Did I ask the AI to generate something imaginative or novel?'}
      ],
      data: [
        {code:'P', label:'Public', exclusive:false, question:'Did I only use publicly available info or text I wrote?'},
        {code:'I', label:'Internal', exclusive:false, question:'Did I provide company docs or private sources?'},
        {code:'M', label:'Model‑only', exclusive:true, question:'Did I give no new sources, just a plain prompt?'},
        {code:'U', label:'Unclear', exclusive:true, question:'Am I unsure of what sources shaped the answer?'}
      ],
      method: [
        {code:'R', label:'Raw', question:'Did I publish the model\'s first answer essentially as-is?'},
        {code:'G', label:'Guided', question:'Did I break the task into steps or feed it context?'},
        {code:'W', label:'Rewriter', question:'Did I give it text and ask it to reformat or restyle it?'},
        {code:'A', label:'Augmented', question:'Did I use connected tools beyond the base model?'}
      ],
      review: [
        {code:'U', label:'Unreviewed', question:'Did I post without reading or reviewing it myself?'},
        {code:'S', label:'Skimmed', question:'Did I glance over it but not verify details?'},
        {code:'P', label:'Peer', question:'Did someone with general familiarity read it closely?'},
        {code:'E', label:'Expert', question:'Did an expert review for accuracy?'},
        {code:'A', label:'AI‑Check', question:'Did I prompt the AI to review its own draft?'}
      ]
    };

    let aiModels = [];
    let selectedModels = [];
    let currentWizardSection = '';

    const WIZARD_DATA = {
      role: {
        title: 'What job did the AI do?',
        options: TAGS.role.map(t => ({
          code: t.code,
          label: t.label,
          description: t.question.replace('Did ', '').replace('?', '')
        }))
      },
      data: {
        title: 'What sources were given?',
        allowMultiple: true,
        options: TAGS.data.map(t => ({
          code: t.code,
          label: t.label,
          description: t.question.replace('Did ', '').replace('?', ''),
          exclusive: t.exclusive
        }))
      },
      method: {
        title: 'How was the AI used?',
        options: TAGS.method.map(t => ({
          code: t.code,
          label: t.label,
          description: t.question.replace('Did ', '').replace('?', '')
        }))
      },
      review: {
        title: 'How was the output reviewed?',
        allowMultiple: true,
        options: TAGS.review.map(t => ({
          code: t.code,
          label: t.label,
          description: t.question.replace('Did ', '').replace('?', '')
        }))
      }
    };

    Object.entries(TAGS).forEach(([group, arr]) => {
      const fieldset = document.getElementById(`${group}-group`);
      const legend = fieldset.querySelector('legend');
      fieldset.innerHTML = '';
      fieldset.appendChild(legend);

      const cardsContainer = document.createElement('div');
      cardsContainer.className = 'option-cards';

      arr.forEach(tag => {
        let inputType = 'radio';
        let inputName = group;

        if (group === 'data' && !tag.exclusive) {
          inputType = 'checkbox';
          inputName = 'data-inclusive';
        } else if (group === 'review') {
          inputType = 'checkbox';
          inputName = 'review-multi';
        }

        const card = document.createElement('label');
        card.className = 'option-card';
        card.innerHTML = `
          <input type="${inputType}" name="${inputName}" value="${tag.code}" 
                 id="${group}-${tag.code}" ${tag.exclusive ? 'data-exclusive="true"' : ''}>
          <div class="card-content">
            <div class="card-header">
              <span class="code">${tag.code}</span>
              <span class="label">${tag.label}</span>
            </div>
            <div class="help-text">${tag.question}</div>
          </div>
        `;
        cardsContainer.appendChild(card);
      });

      fieldset.appendChild(cardsContainer);
    });

    document.getElementById('data-group').addEventListener('change', (e) => {
      const target = e.target;

      if (target.dataset.exclusive === 'true' && target.checked) {
        document.querySelectorAll('#data-group input[type="checkbox"]').forEach(cb => {
          cb.checked = false;
          cb.disabled = true;
        });
        document.querySelectorAll('#data-group input[data-exclusive="true"]').forEach(radio => {
          if (radio !== target) {
            radio.checked = false;
          }
          radio.disabled = false;
        });
      } else if (target.type === 'checkbox' && target.checked) {
        document.querySelectorAll('#data-group input[data-exclusive="true"]').forEach(radio => {
          radio.checked = false;
          radio.disabled = true;
        });
        document.querySelectorAll('#data-group input[type="checkbox"]').forEach(cb => {
          cb.disabled = false;
        });
      } else if (!document.querySelector('#data-group input:checked')) {
        document.querySelectorAll('#data-group input').forEach(input => {
          input.disabled = false;
        });
      }

      paint();
    });

    document.querySelector('.controls').addEventListener('change', (e) => {
      if (e.target.closest('#data-group')) return;
      paint();
    });

    // Tag toggle
    document.getElementById('show-tags').addEventListener('change', (e) => {
      const badge = document.getElementById('badge');
      if (e.target.checked) {
        badge.classList.remove('hidden-tags');
      } else {
        badge.classList.add('hidden-tags');
      }
    });

    // Grayscale toggle
    document.getElementById('grayscale-mode').addEventListener('change', (e) => {
      const badge = document.getElementById('badge');
      if (e.target.checked) {
        badge.classList.add('grayscale');
      } else {
        badge.classList.remove('grayscale');
      }
    });

    // Make selection handling
    document.getElementById('make-select').addEventListener('change', (e) => {
      const modelSelect = document.getElementById('model-select');
      const addBtn = document.getElementById('add-model-btn');
      
      modelSelect.innerHTML = '<option value="">Select model...</option>';
      modelSelect.disabled = !e.target.value;
      addBtn.disabled = true;
      
      if (e.target.value) {
        const provider = e.target.value;
        const providerModels = aiModels.filter(model => model.id.startsWith(provider + '/'));
        
        providerModels
          .sort((a, b) => a.name.localeCompare(b.name))
          .forEach(model => {
            const option = document.createElement('option');
            option.value = model.id;
            option.textContent = model.name; // Full name, no truncation
            modelSelect.appendChild(option);
          });
      }
    });

    // Model selection handling
    document.getElementById('model-select').addEventListener('change', (e) => {
      const addBtn = document.getElementById('add-model-btn');
      addBtn.disabled = !e.target.value;
    });

    // Add selected model
    function addSelectedModel() {
      const makeSelect = document.getElementById('make-select');
      const modelSelect = document.getElementById('model-select');
      
      if (!makeSelect.value || !modelSelect.value) return;
      
      const selectedModel = aiModels.find(model => model.id === modelSelect.value);
      if (!selectedModel) return;
      
      // Check if already selected
      if (selectedModels.find(m => m.id === selectedModel.id)) {
        alert('This model is already selected.');
        return;
      }
      
      selectedModels.push(selectedModel);
      updateSelectedModelsDisplay();
      updateCitation();
      
      // Reset selections
      makeSelect.value = '';
      modelSelect.innerHTML = '<option value="">Select model...</option>';
      modelSelect.disabled = true;
      document.getElementById('add-model-btn').disabled = true;
    }

    // Remove selected model
    function removeSelectedModel(modelId) {
      selectedModels = selectedModels.filter(m => m.id !== modelId);
      updateSelectedModelsDisplay();
      updateCitation();
    }

    // Make these functions global
    window.addSelectedModel = addSelectedModel;
    window.removeSelectedModel = removeSelectedModel;
    window.downloadBadge = downloadBadge;
    window.copyCitation = copyCitation;
    window.loadAIModels = loadAIModels;
    window.openWizard = openWizard;
    window.closeWizard = closeWizard;
    window.applyWizardStep = applyWizardStep;

    function openWizard(section) {
      currentWizardSection = section;
      document.getElementById('wizard-modal').style.display = 'flex';
      document.getElementById('wizard-title').textContent = `TRACE Helper: ${section.charAt(0).toUpperCase() + section.slice(1)}`;
      showWizardStep();
    }

    function closeWizard() {
      document.getElementById('wizard-modal').style.display = 'none';
    }

    function showWizardStep() {
      const step = WIZARD_DATA[currentWizardSection];
      const modalBody = document.getElementById('wizard-question');

      modalBody.innerHTML = `
        <h3>${step.title}</h3>
        <div class="wizard-options">
          ${step.options.map(opt => `
            <label class="wizard-option">
              <input type="${step.allowMultiple ? 'checkbox' : 'radio'}" 
                     name="wizard-${currentWizardSection}" 
                     value="${opt.code}" ${opt.exclusive ? 'data-exclusive="true"' : ''}>
              <div class="wizard-option-content">
                <strong>${opt.label}</strong>
                <span>${opt.description}</span>
              </div>
            </label>
          `).join('')}
        </div>
        <button class="button" onclick="applyWizardStep()">
          Next →
        </button>
      `;

      if (currentWizardSection === 'data') {
        modalBody.querySelector('.wizard-options').addEventListener('change', (e) => {
          const target = e.target;
          if (target.dataset.exclusive === 'true' && target.checked) {
            modalBody.querySelectorAll('input[type="checkbox"]').forEach(cb => {
              cb.checked = false;
              cb.disabled = true;
            });
            modalBody.querySelectorAll('input[data-exclusive="true"]').forEach(rb => {
              rb.disabled = false;
              if (rb !== target) rb.checked = false;
            });
          } else if (target.type === 'checkbox' && target.checked) {
            modalBody.querySelectorAll('input[data-exclusive="true"]').forEach(rb => {
              rb.checked = false;
              rb.disabled = true;
            });
            modalBody.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.disabled = false);
          } else if (!modalBody.querySelector('input:checked')) {
            modalBody.querySelectorAll('input').forEach(inp => inp.disabled = false);
          }
        });
      }
    }

    function applyWizardStep() {
      const selections = [...document.querySelectorAll(`#wizard-question input:checked`)].map(i => i.value);

      const fieldset = document.getElementById(`${currentWizardSection}-group`);
      fieldset.querySelectorAll('input').forEach(input => {
        input.checked = false;
        input.disabled = false;
      });

      if (currentWizardSection === 'data') {
        const exclusiveSelected = selections.find(code => TAGS.data.find(t => t.code === code)?.exclusive);
        if (exclusiveSelected) {
          const input = document.querySelector(`#data-group input[value="${exclusiveSelected}"]`);
          if (input) input.checked = true;
        } else {
          selections.forEach(code => {
            const input = document.querySelector(`#data-group input[value="${code}"]`);
            if (input) input.checked = true;
          });
        }
        const first = document.querySelector('#data-group input:checked');
        if (first) first.dispatchEvent(new Event('change', { bubbles: true }));
      } else {
        selections.forEach(code => {
          const input = document.querySelector(`#${currentWizardSection}-group input[value="${code}"]`);
          if (input) input.checked = true;
        });
      }

      closeWizard();
      paint();
    }

    // Update selected models display
    function updateSelectedModelsDisplay() {
      const container = document.getElementById('selected-models-container');
      const list = document.getElementById('selected-models-list');
      
      if (selectedModels.length === 0) {
        container.style.display = 'none';
      } else {
        container.style.display = 'block';
        list.innerHTML = '';
        
        selectedModels.forEach(model => {
          const provider = model.id.split('/')[0];
          const item = document.createElement('div');
          item.className = 'selected-model-item';
          item.innerHTML = `
            <div class="model-item-info">
              <div class="model-item-name">${model.name}</div>
              <div class="model-item-provider">${provider}</div>
            </div>
            <button class="remove-model-btn" onclick="removeSelectedModel('${model.id}')" title="Remove model">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          `;
          list.appendChild(item);
        });
      }
      
      // Update badge models display
      updateBadgeModelsDisplay();
    }

    // Update badge models display
    function updateBadgeModelsDisplay() {
      const container = document.getElementById('badge-models');
      const list = document.getElementById('badge-models-list');
      
      if (selectedModels.length === 0) {
        container.style.display = 'none';
      } else {
        container.style.display = 'block';
        list.innerHTML = '';
        
        selectedModels.forEach(model => {
          const provider = model.id.split('/')[0];
          const item = document.createElement('div');
          item.className = 'badge-model-item';
          item.innerHTML = `<span class="badge-model-provider">${provider}:</span> ${model.name}`;
          list.appendChild(item);
        });
      }
    }

    // Load AI models from OpenRouter API
    async function loadAIModels() {
      const makeSelect = document.getElementById('make-select');
      const modelSelect = document.getElementById('model-select');
      const status = document.getElementById('model-status');
      const refreshBtn = document.querySelector('.refresh-btn');
      
      try {
        refreshBtn.disabled = true;
        status.innerHTML = '<div class="status-message">Loading latest AI models...</div>';
        
        const response = await fetch('https://openrouter.ai/api/v1/models');
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        aiModels = data.data || [];
        
        // Clear existing options
        makeSelect.innerHTML = '<option value="">Select provider...</option>';
        modelSelect.innerHTML = '<option value="">Select model...</option>';
        modelSelect.disabled = true;
        
        // Get unique providers
        const providers = [...new Set(aiModels.map(model => model.id.split('/')[0]))];
        
        // Sort providers, prioritize major ones
        const priorityProviders = ['openai', 'anthropic', 'google', 'meta-llama', 'microsoft'];
        const sortedProviders = providers.sort((a, b) => {
          const aIndex = priorityProviders.indexOf(a);
          const bIndex = priorityProviders.indexOf(b);
          if (aIndex !== -1 && bIndex !== -1) return aIndex - bIndex;
          if (aIndex !== -1) return -1;
          if (bIndex !== -1) return 1;
          return a.localeCompare(b);
        });
        
        // Populate make dropdown
        sortedProviders.forEach(provider => {
          const option = document.createElement('option');
          option.value = provider;
          option.textContent = provider.charAt(0).toUpperCase() + provider.slice(1);
          makeSelect.appendChild(option);
        });
        
        status.innerHTML = `<div class="status-message status-success">✓ Loaded ${aiModels.length} AI models from ${providers.length} providers</div>`;
        
        setTimeout(() => {
          status.innerHTML = '';
        }, 3000);
        
      } catch (error) {
        console.error('Failed to load AI models:', error);
        status.innerHTML = `<div class="status-message status-error">⚠ Failed to load models: ${error.message}</div>`;
        
        // Add fallback providers
        makeSelect.innerHTML = `
          <option value="">Select provider...</option>
          <option value="openai">OpenAI</option>
          <option value="anthropic">Anthropic</option>
          <option value="google">Google</option>
          <option value="meta-llama">Meta</option>
        `;
      } finally {
        refreshBtn.disabled = false;
      }
    }

    // Consistent sizing that starts with same H1 size regardless of content
    function smartFit(codeNode, labelNode) {
      const box = codeNode.parentElement;
      const edgeSize = 10;
      const padding = edgeSize * 1.8;
      
      const maxWidth = box.clientWidth - (padding * 2) - 12;
      const maxHeight = box.clientHeight - (padding * 2) - 12;
      
      // Enhanced word breaking for labels
      if (labelNode.innerHTML.includes('‑') || labelNode.innerHTML.includes('-')) {
        let content = labelNode.innerHTML;
        content = content.replace(/(\w+)[\-‑](\w+)/g, '$1-<wbr>$2');
        labelNode.innerHTML = content;
      }
      
      // CONSISTENT starting sizes - same for all codes regardless of content length
      // Start with larger size for single letters so they match multi-letter codes
      const codeLength = codeNode.textContent.length;
      let codeSize = codeLength <= 2 ? 0.45 : 0.32;  // Bigger start for single/double letters
      let labelSize = 0.12; 
      
      // Try single-line first
      codeNode.style.whiteSpace = 'nowrap';
      
      // Check if it fits with consistent sizing
      for (let i = 0; i < 15; i++) {
        codeNode.style.fontSize = `calc(var(--badge)*${codeSize})`;
        labelNode.style.fontSize = `calc(var(--badge)*${labelSize})`;
        
        codeNode.offsetHeight;
        labelNode.offsetHeight;
        
        const codeHeight = codeNode.scrollHeight;
        const labelHeight = labelNode.scrollHeight;
        const marginBetween = 8;
        const totalHeight = codeHeight + marginBetween + labelHeight;
        const maxWidthUsed = Math.max(codeNode.scrollWidth, labelNode.scrollWidth);
        
        if (totalHeight <= maxHeight && maxWidthUsed <= maxWidth) {
          break; // Fits perfectly!
        }
        
        // Only shrink if necessary
        codeSize *= 0.94;
        labelSize *= 0.94;
        
        if (codeSize < 0.16) {
          break;
        }
      }
      
      // If still doesn't fit, try wrapping codes
      if (codeSize < 0.18) {
        codeNode.style.whiteSpace = 'normal';
        
        const codeText = codeNode.textContent;
        if (codeText.length > 6) {
          const codes = codeText.split(',');
          if (codes.length > 4) {
            const midpoint = Math.ceil(codes.length / 2);
            codeNode.innerHTML = codes.slice(0, midpoint).join(',') + '<br>' + codes.slice(midpoint).join(',');
          }
        }
        
        // Reset to good sizes for wrapped version
        codeSize = 0.26;
        labelSize = 0.10;
        
        for (let i = 0; i < 20; i++) {
          codeNode.style.fontSize = `calc(var(--badge)*${codeSize})`;
          labelNode.style.fontSize = `calc(var(--badge)*${labelSize})`;
          
          codeNode.offsetHeight;
          labelNode.offsetHeight;
          
          const codeHeight = codeNode.scrollHeight;
          const labelHeight = labelNode.scrollHeight;
          const marginBetween = 8;
          const totalHeight = codeHeight + marginBetween + labelHeight;
          const maxWidthUsed = Math.max(codeNode.scrollWidth, labelNode.scrollWidth);
          
          if (totalHeight <= maxHeight && maxWidthUsed <= maxWidth) {
            break;
          }
          
          codeSize *= 0.94;
          labelSize *= 0.94;
          
          if (codeSize < 0.10) {
            codeSize = 0.10;
            labelSize = 0.04;
            break;
          }
        }
      }
      
      codeNode.style.fontSize = `calc(var(--badge)*${codeSize})`;
      labelNode.style.fontSize = `calc(var(--badge)*${labelSize})`;
    }

    function paint(){
      const getChecked = g => [...document.querySelectorAll(`#${g}-group input:checked`)].map(i=>i.value);

      const roles=getChecked('role');
      const data=getChecked('data');
      const methods=getChecked('method');
      const review=getChecked('review');

      fill('role',roles);
      fill('data',data);
      fill('method',methods);
      fill('review',review);

      updateCitation();
      calculateTrustLevel();
    }

    function fill(slot, codes){
      const cell=document.getElementById(`cell-${slot}`);
      const c=cell.querySelector('.code');
      const l=cell.querySelector('.label');

      c.textContent=codes.join(',');
      l.innerHTML=codes.map(x=>{
        const tag = TAGS[slot].find(t=>t.code===x);
        return tag ? tag.label : '';
      }).join('<br>');
      
      setTimeout(() => {
        smartFit(c, l);
      }, 0);
    }

    function calculateTrustLevel() {
      const role = document.querySelector('input[name="role"]:checked')?.value;
      const data = [...document.querySelectorAll('#data-group input:checked')].map(i => i.value);
      const method = document.querySelector('input[name="method"]:checked')?.value;
      const review = [...document.querySelectorAll('input[name="review-multi"]:checked')].map(i => i.value);

      let trustScore = 50;

      if (role === 'A') trustScore += 20;
      if (role === 'D') trustScore -= 10;
      if (data.includes('P')) trustScore += 10;
      if (data.includes('I')) trustScore -= 5;
      if (data.includes('U')) trustScore -= 15;
      if (review.includes('U')) trustScore -= 30;
      if (review.includes('E')) trustScore += 20;

      const badge = document.getElementById('badge');
      if (trustScore >= 70) {
        badge.style.boxShadow = '0 0 0 10px #10b981 inset, 0 4px 12px rgba(0,0,0,0.1)';
      } else if (trustScore >= 40) {
        badge.style.boxShadow = '0 0 0 10px #f59e0b inset, 0 4px 12px rgba(0,0,0,0.1)';
      } else {
        badge.style.boxShadow = '0 0 0 10px #ef4444 inset, 0 4px 12px rgba(0,0,0,0.1)';
      }
    }

    function updateCitation() {
      const role = document.querySelector('input[name="role"]:checked');
      const data = [...document.querySelectorAll('#data-group input:checked')];
      const method = document.querySelector('input[name="method"]:checked');
      const review = [...document.querySelectorAll('input[name="review-multi"]:checked')];

      const roleText = role ? TAGS.role.find(t => t.code === role.value)?.label.toLowerCase() : 'unspecified';
      const dataText = data.length ? 
        data.map(d => TAGS.data.find(t => t.code === d.value)?.label.toLowerCase()).join(' and ') : 
        'unspecified sources';
      const methodText = method ? TAGS.method.find(t => t.code === method.value)?.label.toLowerCase() : 'unspecified';
      const reviewText = review.length ? 
        review.map(r => TAGS.review.find(t => t.code === r.value)?.label.toLowerCase()).join(' and ') : 
        'unreviewed';

      const traceCode = `${role?.value || ''}–${data.map(d => d.value).join('')}–${method?.value || ''}–${review.map(r => r.value).join('')}`;

      const naturalCitation = `I used AI to ${roleText} with ${dataText} by ${methodText} approach, and the output was ${reviewText}.`;

      const formalCitation = `AI Disclosure (${new Date().toISOString().split('T')[0]})
TRACE: ${traceCode}
Role: ${roleText} | Data: ${dataText} | Method: ${methodText} | Review: ${reviewText}
${selectedModels.length ? 'Models: ' + selectedModels.map(m => m.name).join(', ') : ''}`;

      document.getElementById('citation-content').textContent = formalCitation;
    }

    function copyCitation() {
      const citation = document.getElementById('citation-content').textContent;
      navigator.clipboard.writeText(citation).then(() => {
        const btn = event.target.closest('.button');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20,6 9,17 4,12"/></svg>Copied!';
        setTimeout(() => {
          btn.innerHTML = originalText;
        }, 2000);
      });
    }

    async function downloadBadge() {
      const downloadBtn = document.getElementById('download-btn');
      const originalText = downloadBtn.innerHTML;
      
      try {
        downloadBtn.disabled = true;
        downloadBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="8,12 12,16 16,12"/><line x1="12" y1="8" x2="12" y2="16"/></svg>Generating...';
        
        const badge = document.getElementById('badge');
        
        // Create canvas with higher resolution for better quality
        const canvas = await html2canvas(badge, {
          scale: 3, // 3x resolution for crisp image
          backgroundColor: null, // Transparent background
          useCORS: true,
          allowTaint: true,
          width: badge.offsetWidth,
          height: badge.offsetHeight
        });
        
        // Convert to blob and download
        canvas.toBlob((blob) => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `trace-badge-${new Date().toISOString().split('T')[0]}.png`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
          
          downloadBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20,6 9,17 4,12"/></svg>Downloaded!';
          
          setTimeout(() => {
            downloadBtn.innerHTML = originalText;
            downloadBtn.disabled = false;
          }, 2000);
          
        }, 'image/png', 0.95);
        
      } catch (error) {
        console.error('Download failed:', error);
        downloadBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>Error';
        
        setTimeout(() => {
          downloadBtn.innerHTML = originalText;
          downloadBtn.disabled = false;
        }, 2000);
      }
    }

    // Initialize
    paint();
    loadAIModels();
    updateBadgeModelsDisplay();
  </script>
</body>
</html>
